+++
title = "RegExp正则操作"
template = "page.html"
date = "2019-08-21"
updated = "2020-03-11"
+++


## String to RegExp 转义

```js
// 将字符串安全格式化为正则表达式的源码 
// https://github.com/slevithan/xregexp

/**
 * Escapes any regular expression metacharacters, for use when matching literal strings. The result can safely be used at any point within a regex that uses any flags.
 *
 * @memberOf XRegExp
 * @param {String} str String to escape.
 * @returns {String} String with regex metacharacters escaped.
 *
 * @example
 * XRegExp.escape('Escaped? <.>');
 * // -> 'Escaped\?\ <\.>'
 */
var regStringEscape = function(str) {
    return String(str).replace(/[-[\]{}()*+?.,\\^$|#\s]/g, '\\$&');
};
```



# 创建一个正则对象

```js
/**
 * 通过StringRegExp创建正则对象
 * 注意：字符串中的反斜杠必须通过转义处理，不然无法正常识别出
 */
function createRegExp(regStr) {
  var ref = /^\/(.*?)\/([gimsuy]+)?$/.exec(regStr);
  if(!ref) return;
  
  return new RegExp(ref[1], ref[2]);
}

var reg = createRegExp('/\\d/g');
reg.exec('23aa556', '-'); // --aa---
```



### IP地址匹配

```js
// 匹配IPv4
var IPv4Reg = /^(25[0-5]|2[0-4][0-9]|1?[0-9]{1,2})(.(25[0-5]|2[0-4][0-9]|1?[0-9]{1,2})){3}$/ig;
```
> IPv4是 Internet Protocol version 4 的缩写，表示IP协议的第四个版本。现在互联网上绝大多数的通信流量都是以IPv4数据包的格式封装的。IPv4使用32位2进制位的地址，因此IPv4的地址空间是 2^32 = 4294967296。IPv4通常用点分十进制记法书写，例如192.168.0.1，其中的数字都是十进制的数字，中间用实心圆点分隔一个IPv4地址可以分为网络地址和主机地址两部分，其中网络地址可以使用如下形式描述：192.168.0.0/16，其中斜线后的数字表示网络地址部分的长度是16位，这对应2个字节，即网络地址部分是192.168.0.0。
> 为了便于对IP地址进行管理， 根据IPv4地址的第一个字节，IPv4地址可以分为以下五类。

```js
// 匹配IPv4（非绝对严格模式）如果要更严格的看下面
var IPv6Reg = /^([0-9a-f]|:){1,4}(:([0-9a-f]{0,4})*){1,7}$/ig;
```

> IPv6的128位地址通常写成8组，每组为四个十六进制数的形式。比如：AD80:0000:0000:0000:ABAA:0000:00C2:0002 是一个合法的IPv6地址。这个地址比较长，看起来不方便也不易于书写。零压缩法可以用来缩减其长度。如果几个连续段位的值都是0，那么这些0就可以简单的以::来表示，上述地址就可写成AD80::ABAA:0000:00C2:0002。这里要注意的是只能简化连续的段位的0，其前后的0都要保留，比如AD80的最后的这个0，不能被简化。还有这个只能用一次，在上例中的ABAA后面的0000就不能再次简化。当然也可以在AAAA后面使用::，这样的话前面的12个0就不能压缩了。这个限制的目的是为了能准确还原被压缩的0，不然就无法确定每个::代表了多少个0。例如，下面是一些合法的IPv6地址：
> CDCD:910A:2222:5498:8475:1111:3900:2020
> 1030::C9B4:FF12:48AA:1A2B
> 2000:0:0:0:0:0:0:1
> 同时前导的零可以省略，因此2001:0DB8:02de::0e13等价于2001:DB8:2de::e13。
> 一个IPv6地址可以将一个IPv4地址内嵌进去，并且写成IPv6形式和平常习惯的IPv4形式的混合体。IPv6有两种内嵌IPv4的方式：IPv4映像地址和IPv4兼容地址。



```js
// 同时匹配IPv4、IPv6
var ipReg = /((^\s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*$)|(^\s*((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$))/ig;
```

更详细的看https://github.com/sindresorhus/ip-regex